{% extends "base.html" %}
{% set title = "Issue Management" %}

{% block content %}
<div class="issue-management-page">

    <!-- =========================
         Page Header
    ========================== -->
    <div class="page-header">
        <h2>ğŸ§‘â€âš–ï¸ Issue Management</h2>
        <p class="page-subtext">
            Review, respond to, and resolve constituency issues.
        </p>
    </div>

    {% if issues %}
        {% for issue in issues %}
            <div class="issue-card">

                <!-- Issue Header -->
                <div class="issue-header">
                    <a
                        href="{{ url_for('citizen.issue_detail', issue_id=issue.id) }}"
                        class="issue-title"
                    >
                        {{ issue.title }}
                    </a>

                    <span class="status status-{{ issue.status|lower }}">
                        {{ issue.status }}
                    </span>
                </div>

                <!-- Meta -->
                <div class="issue-meta">
                    <span class="category">
                        {{ issue.category }}
                    </span>
                    <span class="date">
                        Raised on {{ issue.created_at }}
                    </span>
                </div>

                <!-- Description Preview -->
                <p class="issue-preview">
                    {{ issue.description[:150] }}
                    {% if issue.description|length > 150 %}...{% endif %}
                </p>

                <!-- Actions -->
                <div class="issue-actions">

                    <a
                        href="{{ url_for('citizen.issue_detail', issue_id=issue.id) }}"
                        class="btn-secondary"
                    >
                        ğŸ’¬ View Discussion
                    </a>

                    {% if issue.status != "Resolved" %}
                        <form
                            method="POST"
                            action="{{ url_for('representative.resolve_issue', issue_id=issue.id) }}"
                            style="display:inline;"
                        >
                            <button class="btn-primary">
                                âœ… Mark as Resolved
                            </button>
                        </form>
                    {% else %}
                        <span class="resolved-indicator">
                            âœ” Awaiting Citizen Confirmation
                        </span>
                    {% endif %}

                </div>

            </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <p>No issues found for your constituency.</p>
        </div>
    {% endif %}

</div>
{% endblock %}
